{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"index.html","title":"DeadRat Bot Framework \ud83d\udc00","text":"<p>\u041b\u0435\u0433\u043a\u0438\u0439 \u0441\u0438\u043d\u0445\u0440\u043e\u043d\u043d\u044b\u0439 \u0444\u0440\u0435\u0439\u043c\u0432\u043e\u0440\u043a \u0434\u043b\u044f Telegram \u0431\u043e\u0442\u043e\u0432.</p>"},{"location":"index.html#_1","title":"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430","text":"<pre><code>pip install deadrat\n</code></pre>"},{"location":"index.html#_2","title":"\u041f\u0435\u0440\u0432\u044b\u0439 \u0431\u043e\u0442","text":"<p>\u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u0444\u0430\u0439\u043b <code>main.py</code> \u0438 \u0432\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u043a\u043e\u0434:</p> <pre><code>from deadrat import Bot, Message\n\n# 1. \u0418\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f\nbot = Bot(\"API_KEY\") # \u0417\u0430\u043c\u0435\u043d\u0438\u0442\u0435 \u043d\u0430 \u0441\u0432\u043e\u0439 \u043a\u043b\u044e\u0447\n\n# 2. \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u043a\u043e\u043c\u0430\u043d\u0434\u044b /start\n@bot.command(\"/start\")\ndef start(msg: Message):\n    msg.reply(f\"\u041f\u0440\u0438\u0432\u0435\u0442, {msg.author.username}!\")\n\n# 3. \u0417\u0430\u043f\u0443\u0441\u043a\nbot.run()\n</code></pre>"},{"location":"index.html#_3","title":"\ud83d\udcda \u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438","text":"<p>\u042d\u0442\u0438\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0430\u043b \u043d\u0435 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044f. \u0424\u0440\u0435\u0439\u043c\u0432\u043e\u0440\u043a \u0443\u043c\u0435\u0435\u0442:</p> <ul> <li>\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0444\u0430\u0439\u043b\u044b \u0438 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438.</li> <li>\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438 \u0443\u0434\u0430\u043b\u044f\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.</li> <li>\u041e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0442\u044c \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u044b \u043a\u043e\u043c\u0430\u043d\u0434 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, <code>/ban user</code>).</li> <li>\u041b\u043e\u0432\u0438\u0442\u044c \u0441\u0438\u0441\u0442\u0435\u043c\u043d\u044b\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u044f (\u043e\u0448\u0438\u0431\u043a\u0438, \u0441\u0442\u0430\u0440\u0442, \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435).    \ud83d\udcd6 \u0427\u0438\u0442\u0430\u0442\u044c \u043f\u043e\u043b\u043d\u0443\u044e \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044e API</li> </ul>"},{"location":"reference.html","title":"\u0421\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a API","text":""},{"location":"reference.html#deadrat.Bot","title":"Bot","text":"<p>The main Bot class that orchestrates API communication and message handling.</p> <p>Parameters:</p> Name Type Description Default <code>api_key</code> <code>str</code> <p>Your unique API key for authentication.</p> required <code>base_url</code> <code>str</code> <p>The base URL for the bot API endpoint.                       Defaults to the official DeadRat API.</p> <code>DEFAULT_API_URL</code> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>class Bot:\n    \"\"\"\n    The main Bot class that orchestrates API communication and message handling.\n\n    Args:\n        api_key (str): Your unique API key for authentication.\n        base_url (str, optional): The base URL for the bot API endpoint.\n                                  Defaults to the official DeadRat API.\n    \"\"\"\n\n    def __init__(self, api_key: str, base_url: str = DEFAULT_API_URL) -&gt; None:\n        self.api_key: str = api_key\n        self.base_url: str = base_url.rstrip(\"/\")\n        self.root_url: str = self.base_url.replace(\"/bot\", \"\")\n\n        self.session: requests.Session = requests.Session()\n        self.session.headers.update({\"x-api-key\": self.api_key})\n\n        self.command_handlers: Dict[str, Tuple[CommandHandler, bool]] = {}\n        self.message_handlers: List[MessageHandler] = []\n        self.event_handlers: Dict[str, Optional[GenericEventHandler]] = {\n            \"startup\": None,\n            \"shutdown\": None,\n            \"connection_error\": None,\n            \"error\": None,\n        }\n\n        self.last_ts: float = 0.0\n\n    # --- API Actions ---\n\n    def upload_file(self, file_path: str) -&gt; Optional[str]:\n        \"\"\"\n        Uploads a file to the server.\n\n        Args:\n            file_path (str): The local path to the file.\n\n        Returns:\n            str | None: The URL of the uploaded file on success, otherwise None.\n        \"\"\"\n        if not os.path.exists(file_path):\n            logger.error(f\"File not found: {file_path}\")\n            return None\n        url = f\"{self.root_url}/upload\"\n        try:\n            with open(file_path, \"rb\") as f:\n                files = {\"file\": f}\n                resp = self.session.post(url, files=files)\n            if resp.status_code == 200:\n                return resp.json().get(\"file_url\")\n            else:\n                logger.error(f\"Upload failed ({resp.status_code}): {resp.text}\")\n                return None\n        except Exception as e:\n            logger.error(f\"Upload error: {e}\")\n            return None\n\n    def send_message(\n        self,\n        text: Optional[str] = None,\n        image_url: Optional[str] = None,\n        reply_to_id: Optional[str] = None,\n    ) -&gt; Optional[SentMessage]:\n        \"\"\"\n        Sends a message to the chat.\n\n        Args:\n            text (str, optional): The text content of the message.\n            image_url (str, optional): A URL to an image to be included in the message.\n            reply_to_id (str, optional): The ID of the message to reply to.\n\n        Returns:\n            SentMessage | None: A SentMessage object on success, or None on failure.\n        \"\"\"\n        try:\n            payload: Dict[str, Any] = {}\n            if text:\n                payload[\"text\"] = text\n            if image_url:\n                payload[\"imageUrl\"] = image_url\n            if reply_to_id:\n                payload[\"replyTo\"] = reply_to_id\n\n            resp = self.session.post(f\"{self.base_url}/send\", json=payload)\n            if resp.status_code == 200:\n                return SentMessage(resp.json(), self, initial_text=text)\n            else:\n                logger.error(f\"Send failed ({resp.status_code}): {resp.text}\")\n                return None\n        except Exception as e:\n            logger.error(f\"Send error: {e}\")\n            return None\n\n    def edit_message(self, target: Union[SentMessage, str], new_text: str) -&gt; bool:\n        \"\"\"\n        Edits an existing message.\n\n        Args:\n            target (SentMessage | str): The SentMessage object or the message ID string to edit.\n            new_text (str): The new text content.\n\n        Returns:\n            bool: True on success, False on failure.\n        \"\"\"\n        msg_id = target.id if isinstance(target, SentMessage) else target\n        if not msg_id:\n            return False\n        try:\n            resp = self.session.put(\n                f\"{self.base_url}/edit/{msg_id}\", json={\"text\": new_text}\n            )\n            return resp.status_code == 200\n        except Exception:\n            return False\n\n    def delete_message(self, target: Union[SentMessage, str]) -&gt; bool:\n        \"\"\"\n        Deletes a message.\n\n        Args:\n            target (SentMessage | str): The SentMessage object or the message ID string to delete.\n\n        Returns:\n            bool: True on success, False on failure.\n        \"\"\"\n        msg_id = target.id if isinstance(target, SentMessage) else target\n        if not msg_id:\n            return False\n        try:\n            resp = self.session.delete(f\"{self.base_url}/delete/{msg_id}\")\n            return resp.status_code == 200\n        except Exception:\n            return False\n\n    # --- Decorators for registering handlers ---\n\n    def command(self, trigger: str) -&gt; Callable[[CommandHandler], CommandHandler]:\n        \"\"\"\n        Decorator: Registers a function to handle a specific command.\n\n        Example:\n            ```python\n            @bot.command(\"/start\")\n            def start(msg):\n                msg.reply(\"Hello!\")\n            ```\n\n        Args:\n            trigger (str): The command string (e.g., \"/start\" or \"!help\").\n        \"\"\"\n\n        def decorator(func: CommandHandler) -&gt; CommandHandler:\n            sig = inspect.signature(func)\n            params = sig.parameters\n            wants_args = len(params) == 2\n\n            if len(params) &gt; 2:\n                logger.warning(\n                    f\"Command '{trigger}' handler has {len(params)} args. \"\n                    f\"Only the first 2 will be used (Message, List[str]).\"\n                )\n\n            self.command_handlers[trigger] = (func, wants_args)\n            return func\n\n        return decorator\n\n    def on_message(self) -&gt; Callable[[MessageHandler], MessageHandler]:\n        \"\"\"\n        Decorator: Registers a handler for all non-command messages.\n\n        Example:\n            ```python\n            @bot.on_message()\n            def echo(msg):\n                msg.reply(msg.text)\n            ```\n        \"\"\"\n\n        def decorator(func: MessageHandler) -&gt; MessageHandler:\n            self.message_handlers.append(func)\n            return func\n\n        return decorator\n\n    def event(self, event_name: str) -&gt; EventDecorator:\n        \"\"\"\n        Decorator: Registers a handler for lifecycle events.\n\n        Example:\n            ```python\n            @bot.event(\"startup\")\n            def on_start():\n                print(\"Bot started!\")\n            ```\n\n        Args:\n            event_name (str): The event type. Options: `'startup'`, `'shutdown'`, `'error'`.\n        \"\"\"\n\n        def decorator(func: GenericEventHandler) -&gt; GenericEventHandler:\n            if event_name in self.event_handlers:\n                self.event_handlers[event_name] = func\n            else:\n                logger.warning(f\"Unknown event type: {event_name}\")\n            return func\n\n        return decorator\n\n    def _trigger(self, event_name: str, *args: Any) -&gt; None:\n        \"\"\"Internal method to safely execute an event handler.\"\"\"\n        handler = self.event_handlers.get(event_name)\n        if handler:\n            try:\n                handler(*args)\n            except Exception as e:\n                logger.error(f\"Error in '{event_name}' handler: {e}\")\n\n    # --- Main Run Loop ---\n\n    def run(self) -&gt; None:\n        \"\"\"\n        Starts the bot's main loop using long polling.\n\n        This method blocks execution until the bot is stopped (Ctrl+C).\n        It handles connection errors and automatic reconnections.\n        \"\"\"\n        logger.info(f\"\ud83e\udd16 Connecting to {self.base_url}...\")\n        try:\n            resp = self.session.get(\n                f\"{self.base_url}/updates\", params={\"after_ts\": 0.0}, timeout=5\n            )\n            if resp.status_code == 200:\n                initial_messages: List[MessagePayload] = resp.json()\n                if initial_messages:\n                    self.last_ts = initial_messages[-1][\"timestamp\"] + 0.000001\n                    logger.info(f\"\u2705 Synced. Last TS: {self.last_ts}\")\n                else:\n                    self.last_ts = time.time()\n            else:\n                self.last_ts = time.time()\n        except Exception:\n            self.last_ts = time.time()\n\n        self._trigger(\"startup\")\n        logger.info(\"\ud83d\ude80 Listening (Long Polling)...\")\n\n        try:\n            while True:\n                try:\n                    resp = self.session.get(\n                        f\"{self.base_url}/updates\",\n                        params={\"after_ts\": self.last_ts},\n                        timeout=25,\n                    )\n\n                    if resp.status_code == 200:\n                        messages: List[MessagePayload] = resp.json()\n                        for msg_data in messages:\n                            self.last_ts = msg_data[\"timestamp\"]\n                            msg = Message(msg_data, self)\n\n                            logger.info(f\"[{msg.author.username}]: {msg.text}\")\n\n                            cmd_triggered = False\n                            handler_data = self.command_handlers.get(msg.command)\n\n                            if handler_data:\n                                func, wants_args = handler_data\n                                try:\n                                    if wants_args:\n                                        func(msg, msg.args)\n                                    else:\n                                        func(msg)\n                                except Exception as e:\n                                    logger.error(\n                                        f\"Error in command handler for '{msg.command}': {e}\"\n                                    )\n                                    self._trigger(\"error\", e, msg)\n\n                                cmd_triggered = True\n\n                            if not cmd_triggered:\n                                for handler in self.message_handlers:\n                                    handler(msg)\n\n                    elif resp.status_code == 403:\n                        logger.critical(\"\u26d4 Invalid API Key\")\n                        break\n                    else:\n                        logger.warning(f\"Server returned: {resp.status_code}\")\n                        time.sleep(2)\n\n                except requests.exceptions.ReadTimeout:\n                    continue\n                except requests.exceptions.ConnectionError:\n                    logger.error(\"Connection lost.\")\n                    self._trigger(\"connection_error\")\n                    time.sleep(5)\n                except Exception as e:\n                    logger.error(f\"Loop error: {e}\")\n                    self._trigger(\"error\", e)\n                    time.sleep(1)\n\n        except KeyboardInterrupt:\n            logger.info(\"Stopping bot...\")\n            self._trigger(\"shutdown\")\n            sys.exit(0)\n</code></pre>"},{"location":"reference.html#deadrat.Bot.command","title":"command","text":"<pre><code>command(trigger)\n</code></pre> <p>Decorator: Registers a function to handle a specific command.</p> Example <pre><code>@bot.command(\"/start\")\ndef start(msg):\n    msg.reply(\"Hello!\")\n</code></pre> <p>Parameters:</p> Name Type Description Default <code>trigger</code> <code>str</code> <p>The command string (e.g., \"/start\" or \"!help\").</p> required Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def command(self, trigger: str) -&gt; Callable[[CommandHandler], CommandHandler]:\n    \"\"\"\n    Decorator: Registers a function to handle a specific command.\n\n    Example:\n        ```python\n        @bot.command(\"/start\")\n        def start(msg):\n            msg.reply(\"Hello!\")\n        ```\n\n    Args:\n        trigger (str): The command string (e.g., \"/start\" or \"!help\").\n    \"\"\"\n\n    def decorator(func: CommandHandler) -&gt; CommandHandler:\n        sig = inspect.signature(func)\n        params = sig.parameters\n        wants_args = len(params) == 2\n\n        if len(params) &gt; 2:\n            logger.warning(\n                f\"Command '{trigger}' handler has {len(params)} args. \"\n                f\"Only the first 2 will be used (Message, List[str]).\"\n            )\n\n        self.command_handlers[trigger] = (func, wants_args)\n        return func\n\n    return decorator\n</code></pre>"},{"location":"reference.html#deadrat.Bot.delete_message","title":"delete_message","text":"<pre><code>delete_message(target)\n</code></pre> <p>Deletes a message.</p> <p>Parameters:</p> Name Type Description Default <code>target</code> <code>SentMessage | str</code> <p>The SentMessage object or the message ID string to delete.</p> required <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>True on success, False on failure.</p> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def delete_message(self, target: Union[SentMessage, str]) -&gt; bool:\n    \"\"\"\n    Deletes a message.\n\n    Args:\n        target (SentMessage | str): The SentMessage object or the message ID string to delete.\n\n    Returns:\n        bool: True on success, False on failure.\n    \"\"\"\n    msg_id = target.id if isinstance(target, SentMessage) else target\n    if not msg_id:\n        return False\n    try:\n        resp = self.session.delete(f\"{self.base_url}/delete/{msg_id}\")\n        return resp.status_code == 200\n    except Exception:\n        return False\n</code></pre>"},{"location":"reference.html#deadrat.Bot.edit_message","title":"edit_message","text":"<pre><code>edit_message(target, new_text)\n</code></pre> <p>Edits an existing message.</p> <p>Parameters:</p> Name Type Description Default <code>target</code> <code>SentMessage | str</code> <p>The SentMessage object or the message ID string to edit.</p> required <code>new_text</code> <code>str</code> <p>The new text content.</p> required <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>True on success, False on failure.</p> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def edit_message(self, target: Union[SentMessage, str], new_text: str) -&gt; bool:\n    \"\"\"\n    Edits an existing message.\n\n    Args:\n        target (SentMessage | str): The SentMessage object or the message ID string to edit.\n        new_text (str): The new text content.\n\n    Returns:\n        bool: True on success, False on failure.\n    \"\"\"\n    msg_id = target.id if isinstance(target, SentMessage) else target\n    if not msg_id:\n        return False\n    try:\n        resp = self.session.put(\n            f\"{self.base_url}/edit/{msg_id}\", json={\"text\": new_text}\n        )\n        return resp.status_code == 200\n    except Exception:\n        return False\n</code></pre>"},{"location":"reference.html#deadrat.Bot.event","title":"event","text":"<pre><code>event(event_name)\n</code></pre> <p>Decorator: Registers a handler for lifecycle events.</p> Example <pre><code>@bot.event(\"startup\")\ndef on_start():\n    print(\"Bot started!\")\n</code></pre> <p>Parameters:</p> Name Type Description Default <code>event_name</code> <code>str</code> <p>The event type. Options: <code>'startup'</code>, <code>'shutdown'</code>, <code>'error'</code>.</p> required Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def event(self, event_name: str) -&gt; EventDecorator:\n    \"\"\"\n    Decorator: Registers a handler for lifecycle events.\n\n    Example:\n        ```python\n        @bot.event(\"startup\")\n        def on_start():\n            print(\"Bot started!\")\n        ```\n\n    Args:\n        event_name (str): The event type. Options: `'startup'`, `'shutdown'`, `'error'`.\n    \"\"\"\n\n    def decorator(func: GenericEventHandler) -&gt; GenericEventHandler:\n        if event_name in self.event_handlers:\n            self.event_handlers[event_name] = func\n        else:\n            logger.warning(f\"Unknown event type: {event_name}\")\n        return func\n\n    return decorator\n</code></pre>"},{"location":"reference.html#deadrat.Bot.on_message","title":"on_message","text":"<pre><code>on_message()\n</code></pre> <p>Decorator: Registers a handler for all non-command messages.</p> Example <pre><code>@bot.on_message()\ndef echo(msg):\n    msg.reply(msg.text)\n</code></pre> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def on_message(self) -&gt; Callable[[MessageHandler], MessageHandler]:\n    \"\"\"\n    Decorator: Registers a handler for all non-command messages.\n\n    Example:\n        ```python\n        @bot.on_message()\n        def echo(msg):\n            msg.reply(msg.text)\n        ```\n    \"\"\"\n\n    def decorator(func: MessageHandler) -&gt; MessageHandler:\n        self.message_handlers.append(func)\n        return func\n\n    return decorator\n</code></pre>"},{"location":"reference.html#deadrat.Bot.run","title":"run","text":"<pre><code>run()\n</code></pre> <p>Starts the bot's main loop using long polling.</p> <p>This method blocks execution until the bot is stopped (Ctrl+C). It handles connection errors and automatic reconnections.</p> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def run(self) -&gt; None:\n    \"\"\"\n    Starts the bot's main loop using long polling.\n\n    This method blocks execution until the bot is stopped (Ctrl+C).\n    It handles connection errors and automatic reconnections.\n    \"\"\"\n    logger.info(f\"\ud83e\udd16 Connecting to {self.base_url}...\")\n    try:\n        resp = self.session.get(\n            f\"{self.base_url}/updates\", params={\"after_ts\": 0.0}, timeout=5\n        )\n        if resp.status_code == 200:\n            initial_messages: List[MessagePayload] = resp.json()\n            if initial_messages:\n                self.last_ts = initial_messages[-1][\"timestamp\"] + 0.000001\n                logger.info(f\"\u2705 Synced. Last TS: {self.last_ts}\")\n            else:\n                self.last_ts = time.time()\n        else:\n            self.last_ts = time.time()\n    except Exception:\n        self.last_ts = time.time()\n\n    self._trigger(\"startup\")\n    logger.info(\"\ud83d\ude80 Listening (Long Polling)...\")\n\n    try:\n        while True:\n            try:\n                resp = self.session.get(\n                    f\"{self.base_url}/updates\",\n                    params={\"after_ts\": self.last_ts},\n                    timeout=25,\n                )\n\n                if resp.status_code == 200:\n                    messages: List[MessagePayload] = resp.json()\n                    for msg_data in messages:\n                        self.last_ts = msg_data[\"timestamp\"]\n                        msg = Message(msg_data, self)\n\n                        logger.info(f\"[{msg.author.username}]: {msg.text}\")\n\n                        cmd_triggered = False\n                        handler_data = self.command_handlers.get(msg.command)\n\n                        if handler_data:\n                            func, wants_args = handler_data\n                            try:\n                                if wants_args:\n                                    func(msg, msg.args)\n                                else:\n                                    func(msg)\n                            except Exception as e:\n                                logger.error(\n                                    f\"Error in command handler for '{msg.command}': {e}\"\n                                )\n                                self._trigger(\"error\", e, msg)\n\n                            cmd_triggered = True\n\n                        if not cmd_triggered:\n                            for handler in self.message_handlers:\n                                handler(msg)\n\n                elif resp.status_code == 403:\n                    logger.critical(\"\u26d4 Invalid API Key\")\n                    break\n                else:\n                    logger.warning(f\"Server returned: {resp.status_code}\")\n                    time.sleep(2)\n\n            except requests.exceptions.ReadTimeout:\n                continue\n            except requests.exceptions.ConnectionError:\n                logger.error(\"Connection lost.\")\n                self._trigger(\"connection_error\")\n                time.sleep(5)\n            except Exception as e:\n                logger.error(f\"Loop error: {e}\")\n                self._trigger(\"error\", e)\n                time.sleep(1)\n\n    except KeyboardInterrupt:\n        logger.info(\"Stopping bot...\")\n        self._trigger(\"shutdown\")\n        sys.exit(0)\n</code></pre>"},{"location":"reference.html#deadrat.Bot.send_message","title":"send_message","text":"<pre><code>send_message(text=None, image_url=None, reply_to_id=None)\n</code></pre> <p>Sends a message to the chat.</p> <p>Parameters:</p> Name Type Description Default <code>text</code> <code>str</code> <p>The text content of the message.</p> <code>None</code> <code>image_url</code> <code>str</code> <p>A URL to an image to be included in the message.</p> <code>None</code> <code>reply_to_id</code> <code>str</code> <p>The ID of the message to reply to.</p> <code>None</code> <p>Returns:</p> Type Description <code>Optional[SentMessage]</code> <p>SentMessage | None: A SentMessage object on success, or None on failure.</p> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def send_message(\n    self,\n    text: Optional[str] = None,\n    image_url: Optional[str] = None,\n    reply_to_id: Optional[str] = None,\n) -&gt; Optional[SentMessage]:\n    \"\"\"\n    Sends a message to the chat.\n\n    Args:\n        text (str, optional): The text content of the message.\n        image_url (str, optional): A URL to an image to be included in the message.\n        reply_to_id (str, optional): The ID of the message to reply to.\n\n    Returns:\n        SentMessage | None: A SentMessage object on success, or None on failure.\n    \"\"\"\n    try:\n        payload: Dict[str, Any] = {}\n        if text:\n            payload[\"text\"] = text\n        if image_url:\n            payload[\"imageUrl\"] = image_url\n        if reply_to_id:\n            payload[\"replyTo\"] = reply_to_id\n\n        resp = self.session.post(f\"{self.base_url}/send\", json=payload)\n        if resp.status_code == 200:\n            return SentMessage(resp.json(), self, initial_text=text)\n        else:\n            logger.error(f\"Send failed ({resp.status_code}): {resp.text}\")\n            return None\n    except Exception as e:\n        logger.error(f\"Send error: {e}\")\n        return None\n</code></pre>"},{"location":"reference.html#deadrat.Bot.upload_file","title":"upload_file","text":"<pre><code>upload_file(file_path)\n</code></pre> <p>Uploads a file to the server.</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>str</code> <p>The local path to the file.</p> required <p>Returns:</p> Type Description <code>Optional[str]</code> <p>str | None: The URL of the uploaded file on success, otherwise None.</p> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def upload_file(self, file_path: str) -&gt; Optional[str]:\n    \"\"\"\n    Uploads a file to the server.\n\n    Args:\n        file_path (str): The local path to the file.\n\n    Returns:\n        str | None: The URL of the uploaded file on success, otherwise None.\n    \"\"\"\n    if not os.path.exists(file_path):\n        logger.error(f\"File not found: {file_path}\")\n        return None\n    url = f\"{self.root_url}/upload\"\n    try:\n        with open(file_path, \"rb\") as f:\n            files = {\"file\": f}\n            resp = self.session.post(url, files=files)\n        if resp.status_code == 200:\n            return resp.json().get(\"file_url\")\n        else:\n            logger.error(f\"Upload failed ({resp.status_code}): {resp.text}\")\n            return None\n    except Exception as e:\n        logger.error(f\"Upload error: {e}\")\n        return None\n</code></pre>"},{"location":"reference.html#_1","title":"\u0414\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u044b","text":"<p>\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u044d\u0442\u0438 \u043c\u0435\u0442\u043e\u0434\u044b \u0434\u043b\u044f \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u0439-\u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a\u043e\u0432.</p>"},{"location":"reference.html#deadrat.Bot.command","title":"command","text":"<pre><code>command(trigger)\n</code></pre> <p>Decorator: Registers a function to handle a specific command.</p> Example <pre><code>@bot.command(\"/start\")\ndef start(msg):\n    msg.reply(\"Hello!\")\n</code></pre> <p>Parameters:</p> Name Type Description Default <code>trigger</code> <code>str</code> <p>The command string (e.g., \"/start\" or \"!help\").</p> required Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def command(self, trigger: str) -&gt; Callable[[CommandHandler], CommandHandler]:\n    \"\"\"\n    Decorator: Registers a function to handle a specific command.\n\n    Example:\n        ```python\n        @bot.command(\"/start\")\n        def start(msg):\n            msg.reply(\"Hello!\")\n        ```\n\n    Args:\n        trigger (str): The command string (e.g., \"/start\" or \"!help\").\n    \"\"\"\n\n    def decorator(func: CommandHandler) -&gt; CommandHandler:\n        sig = inspect.signature(func)\n        params = sig.parameters\n        wants_args = len(params) == 2\n\n        if len(params) &gt; 2:\n            logger.warning(\n                f\"Command '{trigger}' handler has {len(params)} args. \"\n                f\"Only the first 2 will be used (Message, List[str]).\"\n            )\n\n        self.command_handlers[trigger] = (func, wants_args)\n        return func\n\n    return decorator\n</code></pre>"},{"location":"reference.html#deadrat.Bot.on_message","title":"on_message","text":"<pre><code>on_message()\n</code></pre> <p>Decorator: Registers a handler for all non-command messages.</p> Example <pre><code>@bot.on_message()\ndef echo(msg):\n    msg.reply(msg.text)\n</code></pre> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def on_message(self) -&gt; Callable[[MessageHandler], MessageHandler]:\n    \"\"\"\n    Decorator: Registers a handler for all non-command messages.\n\n    Example:\n        ```python\n        @bot.on_message()\n        def echo(msg):\n            msg.reply(msg.text)\n        ```\n    \"\"\"\n\n    def decorator(func: MessageHandler) -&gt; MessageHandler:\n        self.message_handlers.append(func)\n        return func\n\n    return decorator\n</code></pre>"},{"location":"reference.html#deadrat.Bot.event","title":"event","text":"<pre><code>event(event_name)\n</code></pre> <p>Decorator: Registers a handler for lifecycle events.</p> Example <pre><code>@bot.event(\"startup\")\ndef on_start():\n    print(\"Bot started!\")\n</code></pre> <p>Parameters:</p> Name Type Description Default <code>event_name</code> <code>str</code> <p>The event type. Options: <code>'startup'</code>, <code>'shutdown'</code>, <code>'error'</code>.</p> required Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def event(self, event_name: str) -&gt; EventDecorator:\n    \"\"\"\n    Decorator: Registers a handler for lifecycle events.\n\n    Example:\n        ```python\n        @bot.event(\"startup\")\n        def on_start():\n            print(\"Bot started!\")\n        ```\n\n    Args:\n        event_name (str): The event type. Options: `'startup'`, `'shutdown'`, `'error'`.\n    \"\"\"\n\n    def decorator(func: GenericEventHandler) -&gt; GenericEventHandler:\n        if event_name in self.event_handlers:\n            self.event_handlers[event_name] = func\n        else:\n            logger.warning(f\"Unknown event type: {event_name}\")\n        return func\n\n    return decorator\n</code></pre>"},{"location":"reference.html#deadrat.Message","title":"Message","text":"<p>Represents a message received by the bot. Contains methods to reply directly to this message.</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>dict</code> <p>The raw JSON payload for the message.</p> required <code>bot</code> <code>Bot</code> <p>The Bot instance that received this message.</p> required <p>Attributes:</p> Name Type Description <code>text</code> <code>str</code> <p>The full text content of the message.</p> <code>author</code> <code>Author</code> <p>The author of the message.</p> <code>reply_to_message</code> <code>Message | None</code> <p>The message object this message is replying to (if any).</p> <code>command</code> <code>str | None</code> <p>The command trigger (e.g., \"/start\") if present.</p> <code>args</code> <code>list[str]</code> <p>List of arguments following the command.</p> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>class Message:\n    \"\"\"\n    Represents a message received by the bot.\n    Contains methods to reply directly to this message.\n\n    Args:\n        data (dict): The raw JSON payload for the message.\n        bot (Bot): The Bot instance that received this message.\n\n    Attributes:\n        text (str): The full text content of the message.\n        author (Author): The author of the message.\n        reply_to_message (Message | None): The message object this message is replying to (if any).\n        command (str | None): The command trigger (e.g., \"/start\") if present.\n        args (list[str]): List of arguments following the command.\n    \"\"\"\n\n    def __init__(self, data: MessagePayload, bot: \"Bot\") -&gt; None:\n        self.bot: \"Bot\" = bot\n        self.id: Optional[str] = data.get(\"id\")\n        self.author: Author = Author(data)\n        self.text: str = data.get(\"text\", \"\").strip()\n        self.timestamp: Optional[float] = data.get(\"timestamp\")\n        self.raw: MessagePayload = data\n\n        self.command: Optional[str] = None\n        self.args: List[str] = []\n        parts = self.text.split(\" \", 1)\n        if parts:\n            self.command = parts[0].lower()\n            if len(parts) &gt; 1:\n                self.args = parts[1].split()\n\n        reply_data: Optional[MessagePayload] = data.get(\"replyToMessage\")\n        if reply_data:\n            self.reply_to_message: Optional[\"Message\"] = Message(reply_data, self.bot)\n        else:\n            self.reply_to_message: Optional[\"Message\"] = None\n\n    def reply(\n        self, text: Optional[str] = None, image_url: Optional[str] = None\n    ) -&gt; Optional[SentMessage]:\n        \"\"\"\n        Replies directly to this message.\n\n        Args:\n            text (str, optional): The text content for the reply.\n            image_url (str, optional): A URL to an image to include in the reply.\n\n        Returns:\n            SentMessage | None: A SentMessage object on success, or None on failure.\n        \"\"\"\n        return self.bot.send_message(\n            text=text, image_url=image_url, reply_to_id=self.id\n        )\n\n    def reply_with_file(\n        self, file_path: str, text: Optional[str] = None\n    ) -&gt; Optional[SentMessage]:\n        \"\"\"\n        Uploads a local file and replies with it.\n\n        Args:\n            file_path (str): The local path to the file to upload.\n            text (str, optional): Optional text to accompany the file.\n\n        Returns:\n            SentMessage | None: A SentMessage object on success, or None on failure.\n        \"\"\"\n        url = self.bot.upload_file(file_path)\n        if url:\n            return self.reply(text=text, image_url=url)\n        return None\n\n    def __repr__(self) -&gt; str:\n        return f\"&lt;Message from {self.author.username}: {self.text[:20]}...&gt;\"\n</code></pre>"},{"location":"reference.html#deadrat.Message.reply","title":"reply","text":"<pre><code>reply(text=None, image_url=None)\n</code></pre> <p>Replies directly to this message.</p> <p>Parameters:</p> Name Type Description Default <code>text</code> <code>str</code> <p>The text content for the reply.</p> <code>None</code> <code>image_url</code> <code>str</code> <p>A URL to an image to include in the reply.</p> <code>None</code> <p>Returns:</p> Type Description <code>Optional[SentMessage]</code> <p>SentMessage | None: A SentMessage object on success, or None on failure.</p> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def reply(\n    self, text: Optional[str] = None, image_url: Optional[str] = None\n) -&gt; Optional[SentMessage]:\n    \"\"\"\n    Replies directly to this message.\n\n    Args:\n        text (str, optional): The text content for the reply.\n        image_url (str, optional): A URL to an image to include in the reply.\n\n    Returns:\n        SentMessage | None: A SentMessage object on success, or None on failure.\n    \"\"\"\n    return self.bot.send_message(\n        text=text, image_url=image_url, reply_to_id=self.id\n    )\n</code></pre>"},{"location":"reference.html#deadrat.Message.reply_with_file","title":"reply_with_file","text":"<pre><code>reply_with_file(file_path, text=None)\n</code></pre> <p>Uploads a local file and replies with it.</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>str</code> <p>The local path to the file to upload.</p> required <code>text</code> <code>str</code> <p>Optional text to accompany the file.</p> <code>None</code> <p>Returns:</p> Type Description <code>Optional[SentMessage]</code> <p>SentMessage | None: A SentMessage object on success, or None on failure.</p> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def reply_with_file(\n    self, file_path: str, text: Optional[str] = None\n) -&gt; Optional[SentMessage]:\n    \"\"\"\n    Uploads a local file and replies with it.\n\n    Args:\n        file_path (str): The local path to the file to upload.\n        text (str, optional): Optional text to accompany the file.\n\n    Returns:\n        SentMessage | None: A SentMessage object on success, or None on failure.\n    \"\"\"\n    url = self.bot.upload_file(file_path)\n    if url:\n        return self.reply(text=text, image_url=url)\n    return None\n</code></pre>"},{"location":"reference.html#deadrat.SentMessage","title":"SentMessage","text":"<p>Represents a message that the bot has successfully sent. Allows editing or deleting the message later.</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>dict</code> <p>The raw JSON payload returned by the API after sending.</p> required <code>bot</code> <code>Bot</code> <p>The Bot instance that sent this message.</p> required <code>initial_text</code> <code>str</code> <p>The original text content of the message.</p> <code>None</code> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>class SentMessage:\n    \"\"\"\n    Represents a message that the bot has successfully sent.\n    Allows editing or deleting the message later.\n\n    Args:\n        data (dict): The raw JSON payload returned by the API after sending.\n        bot (Bot): The Bot instance that sent this message.\n        initial_text (str, optional): The original text content of the message.\n    \"\"\"\n\n    def __init__(\n        self, data: MessagePayload, bot: \"Bot\", initial_text: Optional[str] = None\n    ) -&gt; None:\n        self.bot: \"Bot\" = bot\n        self.id: Optional[str] = data.get(\"id\")\n        self.timestamp: Optional[float] = data.get(\"timestamp\")\n        self.text: Optional[str] = initial_text\n\n    def edit(self, new_text: str) -&gt; bool:\n        \"\"\"\n        Edits this message with new text.\n\n        Args:\n            new_text (str): The new text content for the message.\n\n        Returns:\n            bool: True if the edit was successful, False otherwise.\n        \"\"\"\n        if self.bot.edit_message(self, new_text):\n            self.text = new_text\n            return True\n        return False\n\n    def delete(self) -&gt; bool:\n        \"\"\"\n        Deletes this message from the chat.\n\n        Returns:\n            bool: True if the deletion was successful, False otherwise.\n        \"\"\"\n        return self.bot.delete_message(self)\n\n    def __repr__(self) -&gt; str:\n        return f\"&lt;SentMessage id={self.id}&gt;\"\n</code></pre>"},{"location":"reference.html#deadrat.SentMessage.delete","title":"delete","text":"<pre><code>delete()\n</code></pre> <p>Deletes this message from the chat.</p> <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>True if the deletion was successful, False otherwise.</p> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def delete(self) -&gt; bool:\n    \"\"\"\n    Deletes this message from the chat.\n\n    Returns:\n        bool: True if the deletion was successful, False otherwise.\n    \"\"\"\n    return self.bot.delete_message(self)\n</code></pre>"},{"location":"reference.html#deadrat.SentMessage.edit","title":"edit","text":"<pre><code>edit(new_text)\n</code></pre> <p>Edits this message with new text.</p> <p>Parameters:</p> Name Type Description Default <code>new_text</code> <code>str</code> <p>The new text content for the message.</p> required <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>True if the edit was successful, False otherwise.</p> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>def edit(self, new_text: str) -&gt; bool:\n    \"\"\"\n    Edits this message with new text.\n\n    Args:\n        new_text (str): The new text content for the message.\n\n    Returns:\n        bool: True if the edit was successful, False otherwise.\n    \"\"\"\n    if self.bot.edit_message(self, new_text):\n        self.text = new_text\n        return True\n    return False\n</code></pre>"},{"location":"reference.html#deadrat.Author","title":"Author","text":"<p>Represents the author of a message.</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>dict</code> <p>The raw JSON payload containing author information.</p> required <p>Attributes:</p> Name Type Description <code>id</code> <code>str</code> <p>The unique ID of the user.</p> <code>username</code> <code>str</code> <p>The display name of the user.</p> Source code in <code>src\\deadrat\\__init__.py</code> <pre><code>class Author:\n    \"\"\"\n    Represents the author of a message.\n\n    Args:\n        data (dict): The raw JSON payload containing author information.\n\n    Attributes:\n        id (str): The unique ID of the user.\n        username (str): The display name of the user.\n    \"\"\"\n\n    def __init__(self, data: MessagePayload) -&gt; None:\n        self.id: Optional[str] = data.get(\"author_id\")\n        self.username: Optional[str] = data.get(\"username\")\n\n    def __repr__(self) -&gt; str:\n        return f\"&lt;Author username='{self.username}'&gt;\"\n</code></pre>"}]}